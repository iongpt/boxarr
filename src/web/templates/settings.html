{% extends "base.html" %}

{% block title %}Boxarr Settings{% endblock %}

{% block content %}
<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
    }
    .settings-container {
        background: white;
        border-radius: 10px;
        padding: 40px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        max-width: 800px;
        width: 100%;
        margin: 20px;
    }
    h1 {
        color: #667eea;
        margin: 0 0 10px 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .subtitle {
        color: #718096;
        margin-bottom: 30px;
    }
    .nav-buttons {
        margin-bottom: 20px;
    }
    .nav-btn {
        background: #e2e8f0;
        color: #4a5568;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin-right: 10px;
    }
    .nav-btn:hover {
        background: #cbd5e0;
    }
    .settings-section {
        margin-bottom: 30px;
        padding: 20px;
        background: #f7fafc;
        border-radius: 8px;
    }
    .settings-section h2 {
        color: #4a5568;
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.2em;
    }
    .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #e2e8f0;
    }
    .setting-row:last-child {
        border-bottom: none;
    }
    .setting-label {
        font-weight: 500;
        color: #2d3748;
    }
    .setting-value {
        color: #718096;
        font-family: monospace;
        background: white;
        padding: 5px 10px;
        border-radius: 4px;
    }
    .setting-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .toggle-switch {
        position: relative;
        width: 50px;
        height: 24px;
        background: #cbd5e0;
        border-radius: 12px;
        cursor: pointer;
        transition: background 0.3s;
    }
    .toggle-switch.active {
        background: #667eea;
    }
    .toggle-slider {
        position: absolute;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        transition: transform 0.3s;
    }
    .toggle-switch.active .toggle-slider {
        transform: translateX(26px);
    }
    .btn {
        background: #667eea;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        transition: background 0.3s;
    }
    .btn:hover {
        background: #5a67d8;
    }
    .btn-secondary {
        background: #e2e8f0;
        color: #4a5568;
    }
    .btn-secondary:hover {
        background: #cbd5e0;
    }
    .status-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.85em;
        font-weight: 500;
    }
    .status-connected {
        background: #c6f6d5;
        color: #22543d;
    }
    .status-disconnected {
        background: #feb2b2;
        color: #742a2a;
    }
</style>

<div class="settings-container">
    <div class="nav-buttons">
        <a href="/" class="nav-btn">‚Üê Back to Current Week</a>
        <a href="/dashboard" class="nav-btn">Dashboard</a>
        <a href="/setup" class="nav-btn">Setup Wizard</a>
    </div>
    
    <h1>üé¨ Boxarr Settings</h1>
    <p class="subtitle">Configure your Boxarr instance</p>

    <div class="settings-section">
        <h2>üì° Radarr Connection</h2>
        <div class="setting-row">
            <span class="setting-label">URL</span>
            <span class="setting-value">{{ settings.radarr_url }}</span>
        </div>
        <div class="setting-row">
            <span class="setting-label">API Key</span>
            <span class="setting-value">{{ settings.radarr_api_key }}</span>
        </div>
        <div class="setting-row">
            <span class="setting-label">Root Folder</span>
            <span class="setting-value">{{ settings.radarr_root_folder }}</span>
        </div>
        <div class="setting-row">
            <span class="setting-label">Default Quality Profile</span>
            <span class="setting-value">{{ settings.radarr_quality_profile_default }}</span>
        </div>
        <div class="setting-row">
            <span class="setting-label">Upgrade Quality Profile</span>
            <span class="setting-value">{{ settings.radarr_quality_profile_upgrade }}</span>
        </div>
    </div>

    <div class="settings-section">
        <h2>‚è∞ Scheduler Settings</h2>
        <div class="setting-row">
            <span class="setting-label">Scheduler Enabled</span>
            <div class="setting-toggle">
                <div class="toggle-switch {% if settings.scheduler_enabled %}active{% endif %}" 
                     onclick="toggleSetting('scheduler_enabled', this)">
                    <div class="toggle-slider"></div>
                </div>
                <span>{% if settings.scheduler_enabled %}Enabled{% else %}Disabled{% endif %}</span>
            </div>
        </div>
        <div class="setting-row">
            <span class="setting-label">Update Time</span>
            <span class="setting-value">
                {% if settings.scheduler_day == 0 %}Monday{% endif %}
                {% if settings.scheduler_day == 1 %}Tuesday{% endif %}
                {% if settings.scheduler_day == 2 %}Wednesday{% endif %}
                {% if settings.scheduler_day == 3 %}Thursday{% endif %}
                {% if settings.scheduler_day == 4 %}Friday{% endif %}
                {% if settings.scheduler_day == 5 %}Saturday{% endif %}
                {% if settings.scheduler_day == 6 %}Sunday{% endif %}
                at {{ "%02d"|format(settings.scheduler_hour) }}:{{ "%02d"|format(settings.scheduler_minute) }}
            </span>
        </div>
    </div>

    <div class="settings-section">
        <h2>üéØ Feature Flags</h2>
        <div class="setting-row">
            <span class="setting-label">Auto-Add Movies</span>
            <div class="setting-toggle">
                <div class="toggle-switch {% if settings.auto_add %}active{% endif %}"
                     onclick="toggleSetting('auto_add', this)">
                    <div class="toggle-slider"></div>
                </div>
                <span>{% if settings.auto_add %}Enabled{% else %}Disabled{% endif %}</span>
            </div>
        </div>
        <div class="setting-row">
            <span class="setting-label">Quality Upgrade</span>
            <div class="setting-toggle">
                <div class="toggle-switch {% if settings.quality_upgrade %}active{% endif %}"
                     onclick="toggleSetting('quality_upgrade', this)">
                    <div class="toggle-slider"></div>
                </div>
                <span>{% if settings.quality_upgrade %}Enabled{% else %}Disabled{% endif %}</span>
            </div>
        </div>
    </div>

    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 30px;">
        <button class="btn btn-secondary" onclick="testConnection()">Test Connection</button>
        <button class="btn" onclick="saveSettings()">Save Changes</button>
    </div>
</div>

<script>
function toggleSetting(setting, element) {
    element.classList.toggle('active');
    const isActive = element.classList.contains('active');
    const statusText = element.nextElementSibling;
    if (statusText) {
        statusText.textContent = isActive ? 'Enabled' : 'Disabled';
    }
}

function testConnection() {
    fetch('/api/config/test', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            url: '{{ settings.radarr_url }}',
            api_key: '{{ settings.radarr_api_key|replace("***", "") }}'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ Connection successful!');
        } else {
            alert('‚ùå Connection failed: ' + data.message);
        }
    })
    .catch(error => {
        alert('‚ùå Error testing connection: ' + error);
    });
}

function saveSettings() {
    // Note: This is a read-only view for now
    // Full settings management would require additional endpoints
    alert('Settings are currently read-only. Use the Setup Wizard to modify configuration.');
    window.location.href = '/setup';
}
</script>
{% endblock %}